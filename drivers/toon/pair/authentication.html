<!-- TODO refactor to use built-in OAuth2 Login template -->

<p data-i18n="pair.login_explained"></p>

<script type="application/javascript">
    Homey.setTitle(__('pair.login'));
    document.getElementById("authentication_button").disabled = true;

    var loginUrl;
    Homey.emit('authentication');

    Homey.on('authenticationUrl', function (url) {
    	loginUrl = url;
        document.getElementById("authentication_button").disabled = false;
    });

    Homey.on("authenticated", function (result) {
    	if (typeof result === 'string') {
		    Homey.alert(__("pair.error", {error: result}));
		    Homey.done();
	    } else if (result) {
            Homey.showView("list_toon_devices");
        }
    });
</script>

<button class="button" id="authentication_button" onclick="Homey.popup(loginUrl);">Login</button>