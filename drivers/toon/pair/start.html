<p data-i18n="pair.login_explained"></p>

<script type="application/javascript">
    Homey.setTitle(__('pair.login'));
    document.getElementById("authentication_button").disabled = true;

    var loginUrl;
    Homey.emit('start', {}, function (err, url) {
    	if (err) {
		    Homey.alert(__("pair.error", {error: err}));
		    Homey.done();
		    return err;
	    }
        loginUrl = url;
        document.getElementById("authentication_button").disabled = false;
    });
    Homey.on("authenticated", function (err, token) {
    	if (err) {
		    Homey.alert(__("pair.error", {error: err}));
		    Homey.done();
		    return err;
	    }
        else if (token) {
            Homey.showView("list_toon_devices");
        }
    });
</script>

<button class="button" id="authentication_button" onclick="Homey.popup(loginUrl);">Login</button>